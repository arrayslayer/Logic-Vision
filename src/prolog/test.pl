% initialization & exit
:- dynamic point/3.
:-
    set_prolog_stack(global, limit(2*10**9)),
    set_prolog_stack(local, limit(2*10**9)),
    set_prolog_stack(trail, limit(2*10**9)),
    set_prolog_stack(global, spare(4096)),
    set_prolog_stack(local, spare(4096)),
    set_prolog_stack(trail, spare(2048)),
    set_prolog_stack(global, min_free(16384)),
    set_prolog_stack(local, min_free(4096)),
    set_prolog_stack(trail, min_free(4096)).

load_all_libs:-
    % load primitives
    ['parameters.pl'],
    ['primitive.pl'],
    ['polygon.pl'],
    ['sampler.pl'],
    ['utils.pl'],
    ['conjecture.pl'],
    ['io.pl'],
    
    % debug test files
    ['test_line.pl'].

init:-
    load_all_libs,
    % start image processor
    load_foreign_library(foreign('img_process.so')),
    load_img('../../debug.jpg', _),
    img_quantize(3).

halt_prog:-
    img_release,
    writeln('Halt.'),
    halt.

% test program
test_go:-
    display_refresh,
    sample_conjecture_edges_1(300, 200, E),
    !,
    display_polygon_list(E, g),
    print_list(E),
%    build_connected_components(E, P),
    display_refresh,
    display_polygon_list(E, g),
    open('../../triangles_0.pl', write, Out),
    write_polygons(E, Out, 1),
    close(Out).

test_debug(Conn_comp_list):-
    sample_edges_components([[475,368], [475,368], [86,100], [205,92], [193,31], [263,81], [456,98], [383,99], [326,84], [391,42], [374,149], [402,281], [390,218], [467,204], [472,264], [118,256], [68,169], [114,160], [134,167], [291,156], [235,138], [198,181], [235,232], [309,201], [495,84], [559,66], [500,16], [534,24], [466,64], [239,261], [289,301], [193,309], [143,333], [73,346], [61,282], [88,279], [110,294], [474,373], [457,367], [327,365], [370,338], [459,367], [493,333], [506,269], [582,290], [590,324], [543,259], [569,356], [540,359], [577,188], [519,106], [495,182]], [[[519,106],[466,64]]], Conn_comp_list, [[[[86,100],[205,92]],[[193,31],[263,81]],[[86,100],[193,31]],[[205,92],[263,81]]], [[[456,98],[383,99]],[[326,84],[391,42]],[[326,84],[374,149]],[[374,149],[456,98]],[[383,99],[391,42]]], [[[402,281],[390,218]],[[467,204],[472,264]],[[402,281],[472,264]],[[390,218],[467,204]]], [[[118,256],[68,169]],[[114,160],[134,167]],[[118,256],[134,167]],[[68,169],[114,160]]], [[[291,156],[235,138]],[[198,181],[235,232]],[[235,232],[309,201]],[[291,156],[309,201]],[[198,181],[235,138]]], [[[495,84],[559,66]],[[500,16],[534,24]],[[466,64],[500,16]],[[466,64],[495,84]],[[534,24],[559,66]]], [[[239,261],[289,301]],[[193,309],[239,261]],[[193,309],[289,301]]], [[[143,333],[73,346]],[[61,282],[88,279]],[[110,294],[88,279]],[[110,294],[143,333]],[[61,282],[73,346]]], [[[474,373],[457,367]],[[327,365],[370,338]],[[370,338],[459,367]],[[327,365],[457,367]]], [[[493,333],[506,269]],[[582,290],[590,324]],[[543,259],[582,290]],[[569,356],[590,324]],[[540,359],[569,356]],[[493,333],[540,359]],[[506,269],[543,259]]], [[[577,188],[519,106]],[[495,182],[577,188]],[[495,182],[519,106]]]], [[1,-1.8,58.19999999999999], [1,-1.7761194029850746,56.07462686567163], [1,-1.7876106194690264,57.09734513274336], [1,-1.8043478260869565,60.47826086956519], [1,-1.7647058823529411,52.470588235294144], [1,-1.7777777777777777,55.111111111111086], [1,-1.8095238095238095,63.809523809523796], [1,-1.8055555555555556,62.72222222222223], [1,-0.6,-48.6], [0,1,-99], [1,0.24285714285714285,-110.28571428571428], [1,1.5454545454545454,-240.54545454545453], [1,-1.2727272727272727,-153.54545454545456], [1,-0.19718309859154928,-246.83098591549296], [1,5.4,-705.8], [1,-0.19672131147540983,-186.9016393442623], [1,9.857142857142858,-1111.857142857143], [1,-0.25,-182], [1,27,-2689], [1,-0.19444444444444445,-247.25], [1,-5.461538461538462,179.38461538461536], [1,-0.5689655172413793,27.724137931034477], [1,0.2608695652173913,-112.08695652173913], [1,-10.666666666666666,1734.6666666666667], [1,1.3414634146341464,-461.4146341463415], [1,1.84,-589.04], [1,0.044444444444444446,-129.37777777777777], [1,-0.6666666666666666,135], [1,-0.3442622950819672,24.73770491803279], [1,-13.25,3872.25], [1,-2.2,546.2], [1,18.666666666666668,-3133], [1,-0.5510204081632653,-192.69387755102042], [1,1.5833333333333333,-609.8333333333334], [1,-0.2459016393442623,-61.40983606557377], [1,-0.8431372549019608,-127.43137254901961], [1,0.24193548387096775,-282.5967741935484], [1,4.125,-765.125], [1,-0.35,-51], [1,-0.4153846153846154,-312.10769230769233], [1,-0.7333333333333333,-264.73333333333335], [1,-21,1438], [1,-1.6666666666666667,159.66666666666669], [1,-0.2857142857142857,-61.285714285714285], [1,-0.4523809523809524,-34.61904761904762], [1,-1.7575757575757576,229.030303030303], [1,1.2173913043478262,-429.6521739130435], [1,0.4857142857142857,-242.34285714285716], [1,0.21212121212121213,-172.3030303030303], [1,-3.857142857142857,510.1428571428571], [1,33,-5645], [1,-0.5967741935483871,-26.32258064516129], [1,-0.029411764705882353,-260.61764705882354], [1,20.333333333333332,-2034], [1,1.588235294117647,-459.4117647058823], [1,-2.2,233.39999999999998], [1,-0.4745762711864407,-38.54237288135593], [1,4.6,-845.4], [1,-0.4666666666666667,-39.33333333333333], [1,-0.6111111111111112,-363.72222222222223], [1,-0.2982456140350877,-377.17543859649123], [1,0.07894736842105263,-393.39473684210526], [1,12.2,-1350.8], [1,0.18571428571428572,-401.6714285714286], [1,-3.35,-122.35000000000002], [1,-2,-229], [1,-0.9523809523809523,-311.76190476190476], [1,-2.65,-177.65], [1,-0.5818181818181818,-366.56363636363636], [1,-0.27586206896551724,-379.41379310344826], [1,0.1509433962264151,-397.33962264150944], [1,-3.8,-6.800000000000011], [1,0.18,-400.82], [1,20,-2363], [1,0.29411764705882354,-484.8235294117647], [1,2.857142857142857,-736], [1,1.2272727272727273,-576.2727272727273], [1,0.49230769230769234,-504.24615384615385], [1,-1.71875,-287.5625], [1,-6.3,161.39999999999998], [1,0.42,-497.15999999999997], [1,-0.9795918367346939,-360], [1,-0.26666666666666666,-326.5333333333333], [1,2.764705882352941,-726.9411764705883], [1,-1.3666666666666667,-57.53333333333336], [1,1.4857142857142858,-753.5142857142857], [1,0.3333333333333333,-472.3333333333333], [1,1.0909090909090908,-657.1818181818182], [1,-3.55,475.20000000000005], [1,4.428571428571429,-1645.4285714285713], [1,-0.5652173913043478,-321.7826086956522], [1,-0.509090909090909,-336.6], [1,-0.058823529411764705,-455.47058823529414], [1,4.176470588235294,-1574.5882352941176], [1,-0.5434782608695652,-328.52173913043475], [1,-0.8709677419354839,-242.06451612903226], [1,-13,2960], [1,-0.43548387096774194,-357.0322580645161], [1,-2.6666666666666665,232], [0,1,-264], [1,-0.5272727272727272,-332.8], [1,-0.8490566037735849,-247.8490566037736], [1,0.5166666666666667,-546.1833333333334], [1,0.014925373134328358,-405.1940298507463], [1,0.2698412698412698,-476.8253968253968], [1,0,-401], [1,-0.09615384615384616,-373.9807692307692], [1,2.761904761904762,-1030.4285714285716], [1,0.8611111111111112,-642.6666666666666], [1,0.6491228070175439,-599.421052631579], [1,4.8,-1446.2], [1,-0.2463768115942029,-337.28985507246375], [1,-0.15873015873015872,-356.3968253968254], [1,-0.2318840579710145,-339.4492753623189], [1,0.5333333333333333,-551.8666666666667], [1,0.029850746268656716,-410.3880597014925], [1,0.2857142857142857,-482.2857142857143], [1,2.3,-936.2], [1,1.6,-793.4], [1,-3.8461538461538463,-219.84615384615387], [1,-33,11688], [1,-0.5901639344262295,31.73770491803279], [1,1.8333333333333333,-995.1666666666666], [1,0.5,-542.5], [1,-3,644], [1,0.5614035087719298,-559.7543859649122], [1,1.6296296296296295,-920.8148148148148], [1,0.6666666666666666,-703.6666666666666], [1,0.975609756097561,-817.0487804878048], [1,2.8095238095238093,-1490.095238095238], [1,0.9090909090909091,-362.8181818181818], [1,-4.571428571428571,629.4285714285714], [1,-0.7333333333333333,-137.53333333333333], [1,0.44642857142857145,-299.1607142857143], [1,-0.7346938775510204,-65.0204081632653], [1,-0.25,-54], [1,-0.5714285714285714,-102.42857142857142], [1,2.5,-815], [1,-0.6666666666666666,-175], [1,-0.4,-228.6], [1,-3.0588235294117645,181.05882352941177], [1,-0.6521739130434783,-145], [1,0.49122807017543857,-302.7894736842105], [1,0.3333333333333333,-312.3333333333333], [1,-0.037037037037037035,-226.40740740740742], [1,0.10810810810810811,-260.0810810810811], [1,-0.3783783783783784,-147.2162162162162], [1,-1.4166666666666667,-375.3333333333333], [1,1.4047619047619047,-555.9047619047619], [1,0.7096774193548387,-511.4193548387097], [1,0.07352941176470588,-501.1764705882353], [1,-0.26229508196721313,-495.8032786885246], [1,-2.2222222222222223,-464.44444444444446], [1,-1.2444444444444445,-480.0888888888889], [1,-4.166666666666667,-433.3333333333333], [1,0.65,-549.6], [1,0.33962264150943394,-542.1509433962265], [1,-0.5945945945945946,-519.7297297297297], [1,3.5555555555555554,-793.6666666666666], [1,-0.34782608695652173,-465.7826086956522], [1,-0.9210526315789473,-417.63157894736844], [1,-1,-411], [1,-0.14285714285714285,-483], [1,-0.88,-421.08], [1,0.5178571428571429,-593.1785714285714], [1,0.9523809523809523,-621.8571428571429], [1,0.29411764705882354,-578.4117647058823], [1,-1.2045454545454546,-388.9090909090909], [1,13.4,-4319.2], [1,2.4,-934.6], [1,0.9615384615384616,-490.11538461538464], [1,-0.17857142857142858,-193.57142857142856], [1,-1.1951219512195121,70.73170731707319], [1,-0.13793103448275862,-203], [1,5.363636363636363,-1850.3636363636363], [1,1.5,-508.5], [1,9,-2601], [1,2.1538461538461537,-669.3846153846154], [1,1.3043478260869565,-451.9130434782609], [1,-0.06666666666666667,-43.2], [1,0.22058823529411764,-149.54411764705884], [1,2.1923076923076925,-679.2307692307693], [1,0.9347826086956522,-397.3695652173913], [1,0.5,-246.5], [1,4.615384615384615,-1674.5384615384614], [1,2.125,-849.625], [1,-0.8125,128.5625], [1,0.24324324324324326,-180.27027027027026], [1,0.6792452830188679,-308.0188679245283], [1,-4.363636363636363,1169.5454545454545], [1,-1.5,330.5], [1,-4.083333333333333,1090.5], [1,0.7115384615384616,-319.1923076923077], [1,2.0833333333333335,-836.75], [1,5.384615384615385,-1936.076923076923], [1,0.13333333333333333,-538.3333333333334], [1,-0.38333333333333336,-370.8], [1,0.8372093023255814,-766.2558139534883], [1,-1.1666666666666667,-164], [1,0.2807017543859649,-585.9473684210526], [1,-1.0454545454545454,-156.27272727272725], [1,0.1875,-555.75], [1,-0.40350877192982454,-365.47368421052636], [1,0.782608695652174,-746.2173913043478], [1,-6.6,1270.4], [1,-2.4,421.79999999999995], [1,-2.5,458.5], [1,-0.92,-199.68], [1,0.5263157894736842,-663.9473684210526], [1,-1.7222222222222223,57.83333333333337], [1,0.2962962962962963,-590.1111111111111], [1,0.425531914893617,-631.5957446808511], [1,8.6,-2818.4], [1,4,-1581], [1,14.4,-4273.6], [1,1.6296296296296295,-1081.8518518518517], [1,0.8529411764705882,-792.1470588235294], [1,3.5,-1779.5], [1,2.9047619047619047,-1523.047619047619], [1,1.6428571428571428,-1059.9285714285716], [1,1.024390243902439,-832.9512195121952], [1,-18,6149], [1,1.5714285714285714,-1035.7142857142858], [1,-16,5413], [1,-0.975,-291.475], [1,-1.206896551724138,-231.41379310344826], [1,0.18032786885245902,-635.4754098360655], [1,0.3939393939393939,-697.6363636363636], [1,-0.2413793103448276,-512.7586206896551], [1,-1.2580645161290323,-217.16129032258067], [1,0.6428571428571429,-798.2857142857142], [1,0.19696969696969696,-639.1212121212121], [1,-5.1,1246.6], [1,12,-4841], [1,4.714285714285714,-2232.4285714285716], [1,1.4285714285714286,-1052.857142857143], [1,-1.1842105263157894,-114.86842105263156], [1,-1.6923076923076923,67.53846153846155], [1,-0.30434782608695654,-391.6521739130435], [1,0.475,-651.175], [1,1.0588235294117647,-845.5882352941176], [1,1,-826], [1,-1.8076923076923077,108.96153846153845], [1,7.222222222222222,-3132.777777777778], [1,0.5142857142857142,-664.2571428571429], [1,-1.8,-195.60000000000002], [1,-9,1122], [1,1.3636363636363635,-745.1818181818182], [1,0.40384615384615385,-624.6346153846154], [1,-1.2424242424242424,-93.969696969697], [1,0.16666666666666666,-548.5], [1,0.10526315789473684,-533.3157894736842], [1,-6.8,1323.2], [1,0.203125,-560.640625], [1,1.3243243243243243,-738.0270270270271], [1,0.07142857142857142,-510], [1,-0.7678571428571429,-380.75], [1,-0.05714285714285714,-490.2], [1,5.222222222222222,-1303.2222222222222], [1,0.5,-576], [1,-2.230769230769231,-237.38461538461536], [1,-0.475,-455.1], [1,0.7758620689655172,-610.2068965517242], [1,0.29310344827586204,-550.3448275862069], [1,-9,426], [1,-1.1428571428571428,-399], [1,1.0256410256410255,-626.6923076923077], [1,-1.2926829268292683,-383.2682926829268], [1,1.2727272727272727,-726.6363636363636], [1,-0.675,-448.125], [1,-7.875,315.75], [1,-1.0909090909090908,-403.3636363636364], [1,1,-625]], 390).
